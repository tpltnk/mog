package main

type Chunk []uint8

const TERMINATOR = 0x0F

// Module magic
const (
	MAGIC0 = 0x00
	MAGIC1 = 0x61
	MAGIC2 = 0x73
	MAGIC3 = 0x6D
)

// Module version
const (
	VERSION0 = 0x01
	VERSION1 = 0x00
	VERSION2 = 0x00
	VERSION3 = 0x00
)

type SectionId = uint8

// Module sections
const (
	SEC_CUSTOM SectionId = iota
	SEC_TYPE
	SEC_IMPORT
	SEC_FUNCTION
	SEC_TABLE
	SEC_MEMORY
	SEC_GLOBAL
	SEC_EXPORT
	SEC_START
	SEC_ELEMENT
	SEC_CODE
	SEC_DATA
	SEC_DATACOUNT
	SEC_UNDEFINED // malformed section
)

// Limits
const (
	LIMIT_MINONLY uint8 = iota
	LIMIT_MINMAX
)

// Mutability
const (
	MUT_CONST uint8 = iota
	MUT_VAR
)

// Primitive types encoded as values
const (
	TY_FUN          = 0x60
	TY_REF_FUNCTION = iota + 0x6F
	TY_REF_EXTERN
	TY_VEC_128 = iota + 0x7B
	TY_F64
	TY_F32
	TY_I64
	TY_I32
)

const (
	// Flow control instructions
	OP_CTRL_UNREACHABLE = iota
	OP_CTRL_NOP
	OP_CTRL_BLOCK
	OP_CTRL_LOOP
	OP_CTRL_IF
	OP_CTRL_ELSE
	OP_CTRL_END = (iota - 6) + 0x0B
	OP_CTRL_BREAK
	OP_CTRL_BREAK_IF
	OP_CTRL_BREAK_TABLE
	OP_CTRL_RETURN
	OP_CTRL_CALL
	OP_CTRL_INDIRECT
)

const (
	// Reference instructions
	OP_REF_NULL = iota + 0xD0
	OP_REF_ISNULL
	OP_REF_FUNC
)

const (
	// Parameter instructions
	OP_PARAM_DROP = iota + 0x1A
	OP_PARAM_SELECT
	OP_PARAM_SELECTVEC
)

const (
	// Variable instructions
	OP_VAR_LOCAL_GET = iota + 0x20
	OP_VAR_LOCAL_SET
	OP_VAR_LOCAL_TEE
	OP_VAR_GLOBAL_GET
	OP_VAR_GLOBAL_SET
)

const (
	// Table instructions
	OP_TAB_GET = iota + 0x25
	OP_TAB_SET
	OP_TAB_SIZE = 0xFC
	OP_TAB_GROW
	OP_TAB_SHRINK
	OP_TAB_FILL
	OP_TAB_COPY
	OP_TAB_INIT
	OP_TAB_ELEMDROP
)

const (
	// Memory instructions
	OP_MEM_SIZE = iota + 0x3F
	OP_MEM_GROW
	OP_MEM_SIZE_2 = 0x0
	OP_MEM_GROW_2 = 0x0
	OP_MEM_INIT   = 0xFC
	OP_MEM_DATADROP
	OP_MEM_COPY
	OP_MEM_FILL
)

const (
	// Const instructions
	OP_CONST_I32 = iota + 0x41
	OP_CONST_I64
	OP_CONST_F32
	OP_CONST_F64
)

const (
	// Numeric instructions
	OP_NUM_I32_EQZ = iota + 0x45
	OP_NUM_I32_EQ
	OP_NUM_I32_NE
	OP_NUM_SI32_LT
	OP_NUM_UI32_LT
	OP_NUM_SI32_GT
	OP_NUM_UI32_GT
	OP_NUM_SI32_LE
	OP_NUM_UI32_LE
	OP_NUM_SI32_GE
	OP_NUM_UI32_GE
	OP_NUM_I64_EQ
	OP_NUM_I64_NE
	OP_NUM_SI64_LT
	OP_NUM_UI64_LT
	OP_NUM_SI64_GT
	OP_NUM_UI64_GT
	OP_NUM_SI64_LE
	OP_NUM_UI64_LE
	OP_NUM_SI64_GE
	OP_NUM_UI64_GE

	OP_NUM_F32_EQ
	OP_NUM_F32_NE
	OP_NUM_F32_LT
	OP_NUM_F32_GT
	OP_NUM_F32_LE
	OP_NUM_F32_GE
	OP_NUM_F64_EQ
	OP_NUM_F64_NE
	OP_NUM_F64_LT
	OP_NUM_F64_GT
	OP_NUM_F64_LE
	OP_NUM_F64_GE

	OP_NUM_I32_CLZ
	OP_NUM_I32_CTZ
	OP_NUM_I32_POPCNT
	OP_NUM_I32_ADD
	OP_NUM_I32_SUB
	OP_NUM_I32_MUL
	OP_NUM_SI32_DIV
	OP_NUM_UI32_DIV
	OP_NUM_SI32_REM
	OP_NUM_UI32_REM
	OP_NUM_I32_AND
	OP_NUM_I32_OR
	OP_NUM_I32_XOR
	OP_NUM_I32_SHL
	OP_NUM_SI32_SHR
	OP_NUM_UI32_SHR
	OP_NUM_I32_ROTL
	OP_NUM_I32_ROTR

	OP_NUM_I64_CLZ
	OP_NUM_I64_CTZ
	OP_NUM_I64_POPCNT
	OP_NUM_I64_ADD
	OP_NUM_I64_SUB
	OP_NUM_I64_MUL
	OP_NUM_SI64_DIV
	OP_NUM_UI64_DIV
	OP_NUM_SI64_REM
	OP_NUM_UI64_REM
	OP_NUM_I64_AND
	OP_NUM_I64_OR
	OP_NUM_I64_XOR
	OP_NUM_I64_SHL
	OP_NUM_SI64_SHR
	OP_NUM_UI64_SHR
	OP_NUM_I64_ROTL
	OP_NUM_I64_ROTR

	OP_NUM_F32_ABS
	OP_NUM_F32_NEG
	OP_NUM_F32_CEIL
	OP_NUM_F32_FLOOR
	OP_NUM_F32_TRUNC
	OP_NUM_F32_NEAREST
	OP_NUM_F32_SQRT
	OP_NUM_F32_ADD
	OP_NUM_F32_SUB
	OP_NUM_F32_MUL
	OP_NUM_F32_DIV
	OP_NUM_F32_MIN
	OP_NUM_F32_MAX
	OP_NUM_F32_COPYSIGN

	OP_NUM_F64_ABS
	OP_NUM_F64_NEG
	OP_NUM_F64_CEIL
	OP_NUM_F64_FLOOR
	OP_NUM_F64_TRUNC
	OP_NUM_F64_NEAREST
	OP_NUM_F64_SQRT
	OP_NUM_F64_ADD
	OP_NUM_F64_SUB
	OP_NUM_F64_MUL
	OP_NUM_F64_DIV
	OP_NUM_F64_MIN
	OP_NUM_F64_MAX
	OP_NUM_F64_COPYSIGN

	OP_NUM_I32_WRAP_I64
	OP_NUM_SI32_TRUNC_F32
	OP_NUM_UI32_TRUNC_F32
	OP_NUM_SI32_TRUNC_F64
	OP_NUM_UI32_TRUNC_F64
	OP_NUM_SI64_EXTEND_I32
	OP_NUM_UI64_EXTEND_I32
	OP_NUM_SI64_TRUNC_F32
	OP_NUM_UI64_TRUNC_F32
	OP_NUM_SI64_TRUNC_F64
	OP_NUM_UI64_TRUNC_F64
	OP_NUM_F32_CONVERT_SI32
	OP_NUM_F32_CONVERT_UI32
	OP_NUM_F32_CONVERT_SI64
	OP_NUM_F32_CONVERT_UI64
	OP_NUM_F32_DEMOTE_F64
	OP_NUM_F64_CONVERT_SI32
	OP_NUM_F64_CONVERT_UI32
	OP_NUM_F64_CONVERT_SI64
	OP_NUM_F64_CONVERT_UI64
	OP_NUM_F64_PROMOTE_F32
	OP_NUM_I32_REINTERPRET_F32
	OP_NUM_I64_REINTERPRET_F64
	OP_NUM_F32_REINTERPRET_I32
	OP_NUM_F64_REINTERPRET_I64

	OP_NUM_SI32_EXTEND_8
	OP_NUM_SI32_EXTEND_16
	OP_NUM_SI64_EXTEND_8
	OP_NUM_SI64_EXTEND_16
	OP_NUM_SI64_EXTEND_32

	OP_NUM_SI32_TRUNCSAT_F32 = 0xFC
	OP_NUM_UI32_TRUNCSAT_F32
	OP_NUM_SI32_TRUNCSAT_F64
	OP_NUM_UI32_TRUNCSAT_F64
	OP_NUM_SI64_TRUNCSAT_F32
	OP_NUM_UI64_TRUNCSAT_F32
	OP_NUM_SI64_TRUNCSAT_F64
	OP_NUM_UI64_TRUNCSAT_F64
)

const (
	// Vector instructions
	OP_VEC_V128_LOAD = 0xFD
	OP_VEC_S128_LOAD_8X8
	OP_VEC_U128_LOAD_8X8
	OP_VEC_S128_LOAD_16X4
	OP_VEC_U128_LOAD_16X4
	OP_VEC_S128_LOAD_32X2
	OP_VEC_U128_LOAD_32X2

	OP_VEC_V128_LOADSPLAT_8
	OP_VEC_V128_LOADSPLAT_16
	OP_VEC_V128_LOADSPLAT_32
	OP_VEC_V128_LOADSPLAT_64

	OP_VEC_V128_LOADZERO_32
	OP_VEC_V128_LOADZERO_64

	OP_VEC_V128_STORE

	OP_VEC_V128_LOADLANE_8
	OP_VEC_V128_LOADLANE_16
	OP_VEC_V128_LOADLANE_32
	OP_VEC_V128_LOADLANE_64

	OP_VEC_V128_STORELANE_8
	OP_VEC_V128_STORELANE_16
	OP_VEC_V128_STORELANE_32
	OP_VEC_V128_STORELANE_64

	OP_VEC_SI8X16_EXTRACTLANE
	OP_VEC_UI8X16_EXTRACTLANE
	OP_VEC_I8X16_REPLACELANE
	OP_VEC_SI16X8_EXTRACTLANE
	OP_VEC_UI16X8_EXTRACTLANE
	OP_VEC_I16X8_REPLACELANE
	OP_VEC_I32X4_EXTRACTLANE
	OP_VEC_I32X4_REPLACELANE
	OP_VEC_I64X2_EXTRACTLANE
	OP_VEC_I64X2_REPLACELANE
	OP_VEC_F32X4_EXTRACTLANE
	OP_VEC_F32X4_REPLACELANE
	OP_VEC_F64X2_EXTRACTLANE
	OP_VEC_F64X2_REPLACELANE

	OP_VEC_I8X16_SWIZZLE
	OP_VEC_I8X16_SPLAT
	OP_VEC_I16X8_SPLAT
	OP_VEC_I32X4_SPLAT
	OP_VEC_I64X2_SPLAT
	OP_VEC_F32X4_SPLAT
	OP_VEC_F64X2_SPLAT

	OP_VEC_I8X16_EQ
	OP_VEC_I8X16_NE
	OP_VEC_SI8X16_LT
	OP_VEC_UI8X16_LT
	OP_VEC_SI8X16_GT
	OP_VEC_UI8X16_GT
	OP_VEC_SI8X16_LE
	OP_VEC_UI8X16_LE
	OP_VEC_SI8X16_GE
	OP_VEC_UI8X16_GE

	OP_VEC_I16X8_EQ
	OP_VEC_I16X8_NE
	OP_VEC_SI16X8_LT
	OP_VEC_UI16X8_LT
	OP_VEC_SI16X8_GT
	OP_VEC_UI16X8_GT
	OP_VEC_SI16X8_LE
	OP_VEC_UI16X8_LE
	OP_VEC_SI16X8_GE
	OP_VEC_UI16X8_GE

	OP_VEC_I32X4_EQ
	OP_VEC_I32X4_NE
	OP_VEC_SI32X4_LT
	OP_VEC_UI32X4_LT
	OP_VEC_SI32X4_GT
	OP_VEC_UI32X4_GT
	OP_VEC_SI32X4_LE
	OP_VEC_UI32X4_LE
	OP_VEC_SI32X4_GE
	OP_VEC_UI32X4_GE

	OP_VEC_I64X2_EQ
	OP_VEC_I64X2_NE
	OP_VEC_SI64X2_LT
	OP_VEC_SI64X2_GT
	OP_VEC_SI64X2_LE
	OP_VEC_SI64X2_GE

	OP_VEC_F32X4_EQ
	OP_VEC_F32X4_NE
	OP_VEC_F32X4_LT
	OP_VEC_F32X4_GT
	OP_VEC_F32X4_LE
	OP_VEC_F32X4_GE

	OP_VEC_F64X2_EQ
	OP_VEC_F64X2_NE
	OP_VEC_F64X2_LT
	OP_VEC_F64X2_GT
	OP_VEC_F64X2_LE
	OP_VEC_F64X2_GE

	OP_VEC_V128_NOT
	OP_VEC_V128_AND
	OP_VEC_V128_ANDNOT
	OP_VEC_V128_OR
	OP_VEC_V128_XOR
	OP_VEC_V128_BITSELECT
	OP_VEC_V128_ANYTRUE

	OP_VEC_I8X16_ABS
	OP_VEC_I8X16_NEG
	OP_VEC_I8X16_POPCNT
	OP_VEC_I8X16_ALLTRUE
	OP_VEC_I8X16_BITMASK
	OP_VEC_SI8X16_NARROW_I16X8
	OP_VEC_UI8X16_NARROW_I16X8
	OP_VEC_I8X16_SHL
	OP_VEC_SI8X16_SHR
	OP_VEC_UI8X16_SHR
	OP_VEC_I8X16_ADD
	OP_VEC_SI8X16_ADDSAT
	OP_VEC_UI8X16_ADDSAT
	OP_VEC_I8X16_SUB
	OP_VEC_SI8X16_SUBSAT
	OP_VEC_UI8X16_SUBSAT
	OP_VEC_SI8X16_MIN
	OP_VEC_UI8X16_MIN
	OP_VEC_SI8X16_MAX
	OP_VEC_UI8X16_MAX
	OP_VEC_UI8X16_AVGR

	OP_VEC_SI16X8_EXTENDPAIRWISE_I8X16
	OP_VEC_UI16X8_EXTENDPAIRWISE_I8X16
	OP_VEC_I16X8_ABS
	OP_VEC_I16X8_NEG
	OP_VEC_SI16X8_Q15MULRSAT
	OP_VEC_I16X8_ALLTRUE
	OP_VEC_I16X8_BITMASK
	OP_VEC_SI16X8_NARROW_I32X4
	OP_VEC_UI16X8_NARROW_I32X4
	OP_VEC_SI16X8_EXTENDLOW_I8X16
	OP_VEC_SI16X8_EXTENDHIGH_I8X16
	OP_VEC_UI16X8_EXTENDLOW_I8X16
	OP_VEC_UI16X8_EXTENDHIGH_I8X16
	OP_VEC_I16X8_SHL
	OP_VEC_SI16X8_SHR
	OP_VEC_UI16X8_SHR
	OP_VEC_I16X8_ADD
	OP_VEC_SI16X8_ADDSAT
	OP_VEC_UI16X8_ADDSAT
	OP_VEC_I16X8_SUB
	OP_VEC_SI16X8_SUBSAT
	OP_VEC_UI16X8_SUBSAT
	OP_VEC_I16X8_MUL
	OP_VEC_SI16X8_MIN
	OP_VEC_UI16X8_MIN
	OP_VEC_SI16X8_MAX
	OP_VEC_UI16X8_MAX
	OP_VEC_UI16X8_AVGR
	OP_VEC_SI16X8_EXTMULLOW_I8X16
	OP_VEC_SI16X8_EXTMULHIGH_I8X16
	OP_VEC_UI16X8_EXTMULLOW_I8X16
	OP_VEC_UI16X8_EXTMULHIGH_I8X16

	OP_VEC_SI32X4_EXTENDPAIRWISE_I16X8
	OP_VEC_UI32X4_EXTENDPAIRWISE_I16X8
	OP_VEC_I32X4_ABS
	OP_VEC_I32X4_NEG
	OP_VEC_SI32X4_Q15MULRSAT
	OP_VEC_I32X4_ALLTRUE
	OP_VEC_I32X4_BITMASK
	OP_VEC_SI32X4_EXTENDLOW_I16X8
	OP_VEC_SI32X4_EXTENDHIGH_I16X8
	OP_VEC_UI32X4_EXTENDLOW_I16X8
	OP_VEC_UI32X4_EXTENDHIGH_I16X8
	OP_VEC_I32X4_SHL
	OP_VEC_SI32X4_SHR
	OP_VEC_UI32X4_SHR
	OP_VEC_I32X4_ADD
	OP_VEC_SI32X4_ADDSAT
	OP_VEC_UI32X4_ADDSAT
	OP_VEC_I32X4_SUB
	OP_VEC_SI32X4_SUBSAT
	OP_VEC_UI32X4_SUBSAT
	OP_VEC_I32X4_MUL
	OP_VEC_SI32X4_MIN
	OP_VEC_UI32X4_MIN
	OP_VEC_SI32X4_MAX
	OP_VEC_UI32X4_MAX
	OP_VEC_UI32X4_AVGR
	OP_VEC_SI32X4_EXTMULLOW_I16X8
	OP_VEC_SI32X4_EXTMULHIGH_I16X8
	OP_VEC_UI32X4_EXTMULLOW_I16X8
	OP_VEC_UI32X4_EXTMULHIGH_I16X8

	OP_VEC_I64X2_ABS
	OP_VEC_I64X2_NEG
	OP_VEC_I64X2_ALLTRUE
	OP_VEC_I64X2_BITMASK
	OP_VEC_SI64X2_EXTENDLOW_I32X4
	OP_VEC_SI64X2_EXTENDHIGH_I32X4
	OP_VEC_UI64X2_EXTENDLOW_I32X4
	OP_VEC_UI64X2_EXTENDHIGH_I32X4
	OP_VEC_I64X2_SHL
	OP_VEC_SI64X2_SHR
	OP_VEC_UI64X2_SHR
	OP_VEC_I64X2_ADD
	OP_VEC_I64X2_SUB
	OP_VEC_I64X2_MUL
	OP_VEC_SI64X2_EXTMULLOW_I32X4
	OP_VEC_SI64X2_EXTMULHIGH_I32X4
	OP_VEC_UI64X2_EXTMULLOW_I32X4
	OP_VEC_UI64X2_EXTMULHIGH_I32X4

	OP_VEC_F32X4_CEIL
	OP_VEC_F32X4_FLOOR
	OP_VEC_F32X4_TRUNC
	OP_VEC_F32X4_NEAREST
	OP_VEC_F32X4_ABS
	OP_VEC_F32X4_NEG
	OP_VEC_F32X4_SQRT
	OP_VEC_F32X4_ADD
	OP_VEC_F32X4_SUB
	OP_VEC_F32X4_MUL
	OP_VEC_F32X4_DIV
	OP_VEC_F32X4_MIN
	OP_VEC_F32X4_MAX
	OP_VEC_F32X4_PMIN
	OP_VEC_F32X4_PMAX

	OP_VEC_F64X2_CEIL
	OP_VEC_F64X2_FLOOR
	OP_VEC_F64X2_TRUNC
	OP_VEC_F64X2_NEAREST
	OP_VEC_F64X2_ABS
	OP_VEC_F64X2_NEG
	OP_VEC_F64X2_SQRT
	OP_VEC_F64X2_ADD
	OP_VEC_F64X2_SUB
	OP_VEC_F64X2_MUL
	OP_VEC_F64X2_DIV
	OP_VEC_F64X2_MIN
	OP_VEC_F64X2_MAX
	OP_VEC_F64X2_PMIN
	OP_VEC_F64X2_PMAX

	OP_VEC_SI32X4_TRUNCSAT_F32X4
	OP_VEC_UI32X4_TRUNCSAT_F32X4
	OP_VEC_F32X4_CONVERT_SI32X4
	OP_VEC_F32X4_CONVERT_UI32X4
	OP_VEC_SI32X4_TRUNCSATZERO_F64X2
	OP_VEC_UI32X4_TRUNCSATZERO_F64X2
	OP_VEC_F64X2_CONVERTLOW_SI32X4
	OP_VEC_F64X2_CONVERTLOW_UI32X4
	OP_VEC_F32X4_DEMOTEZERO_F64X2
	OP_VEC_F64X2_PROMOTELOW_F32X4
)
